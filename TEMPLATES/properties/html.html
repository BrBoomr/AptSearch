{% extends 'layout/html.html' %}

{% block content %}

    <!--Loop through all the properties to display all of them-->
    {% for property in properties %}
        <div class="card propertyCard">
            <div class="card-header topSection">
                <div class="row mainRow">
                    <!--Find Out If This Property Has Any Photos-->
                    {% set photoCount = 0 %}
                    {% for picture in pictures %}
                        {% if picture.getPropertyid() == property.getId() %}
                            {% set photoCount = photoCount + 1 %}
                        {% endif %}
                    {% endfor %}
                    <!--If this Property has photos then display them-->
                    {% if photoCount > 0 %}
                        <div class="col-md-auto">
                            <div class="carousel slide" id="slideShow{{ property.getId() }}" data-ride="carousel">
                                <!--If we only have 1 photo then display that single photo-->
                                {% if photoCount == 1 %}
                                    {% for picture in pictures %}
                                        {% if picture.getPropertyid() == property.getId() %}
                                            <div class="carousel-inner">
                                                <div class="carousel-item active">
                                                    <img class="d-block imageInSlide" src="{{ picture.getLink() }}" alt="{{ picture.getDetails() }}">
                                                    <div class="carousel-caption d-none d-md-block">
                                                        <h5 class="carouselCaptionTitle">{{ picture.getDetails() }}</h5>
                                                        <br>
                                                        <p class="carouselCaptionDate">uploaded: {{ picture.getAdddate()|date("m/d/Y") }}</p>
                                                    </div>
                                                </div>
                                            </div> 
                                        {% endif %}
                                    {% endfor %}
                                <!--Other wise display a carousel of photos-->
                                {% else %}
                                    <ol class="carousel-indicators">
                                        <!--Generate all the thumbnails-->
                                        {% set slideID = 0 %}
                                        {% for picture in pictures %}
                                            {% if picture.getPropertyid() == property.getId() %}
                                                <li data-target="#slideShow{{ property.getId() }}" data-slide-to="{{ slideID }}" 
                                                    {% if slideID == 0 %}
                                                        class="active"
                                                    {% endif %}
                                                >
                                                    <img class="d-block w-100 imageInThumbnail" src="{{ picture.getLink() }}" alt="{{ picture.getDetails() }}">
                                                </li>
                                                {% set slideID = slideID +  1 %}
                                            {% endif %}
                                        {% endfor %}
                                    </ol>
                                    <div class="carousel-inner">
                                        <!--Generate all the Slides-->
                                        {% set slideID = 0 %}
                                        {% for picture in pictures %}
                                            {% if picture.getPropertyid() == property.getId() %}
                                                <div class="carousel-item 
                                                {% if slideID == 0 %}
                                                    active
                                                {% endif %}
                                                ">
                                                    <img class="d-block imageInSlide" src="{{ picture.getLink() }}" alt="{{ picture.getDetails() }}">
                                                    <div class="carousel-caption d-none d-md-block">
                                                        <h5 class="carouselCaptionTitle">{{ picture.getDetails() }}</h5>
                                                        <br>
                                                        <p class="carouselCaptionDate">uploaded: {{ picture.getAdddate()|date("m/d/Y") }}</p>
                                                    </div>
                                                </div>
                                                {% set slideID = slideID +  1 %}
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <a class="carousel-control-prev" href="#slideShow{{ property.getId() }}" role="button" data-slide="prev">
                                        <span class="carousel-controls carousel-control-prev-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                    <a class="carousel-control-next" href="#slideShow{{ property.getId() }}" role="button" data-slide="next">
                                        <span class="carousel-controls carousel-control-next-icon" aria-hidden="true"></span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    {% endif %}
                    <div class="col">
                        <h1>{{ property.getPostname() }}</h1>
                        <h5>
                            <!--find our continent name-->
                            {% set continentName = "" %}
                            {% for continentType in continentTypes %}
                                {% if continentType.getId()  == address.getContinenttypeid() %}
                                    {% set continentName = continentType.getName() %}
                                {% endif %}
                            {% endfor %}
                            <!--find our country name-->
                            {% set countryName = "" %}
                            {% for countryType in countryTypes %}
                                {% if countryType.getId()  == address.getCountrytypeid() %}
                                    {% set countryName = countryType.getName() %}
                                {% endif %}
                            {% endfor %}
                            <!--declare our empty address string-->
                            {% set formattedAddress = "" %}
                            <!--generate our address string-->
                            <!--ADDRESS FORMAT => 
                                :Apt 3A | 
                                :101 Grover Rd | 
                                :Edinburg, Texas | 
                                :United States, America
                                : | 78342-->
                            {% for address in addresses %}
                                {% if address.getId() == property.getAddressid() %}
                                    <!--add the apartment identifier if we have it-->
                                    {% if address.getApartmentidentifier() %}
                                        {% set formattedAddress = formattedAddress ~ "Apt " ~ address.getApartmentidentifier() ~ " | "%}
                                    {% endif %}
                                    <!--add the building identifier and street name combo-->
                                    {% if address.getBuildingIndentifier() %}
                                        {% set formattedAddress = formattedAddress ~ address.getBuildingIndentifier() %}
                                        {% if address.getStreetname() %}
                                            {% set formattedAddress = formattedAddress ~ " " ~ address.getStreetname()%}
                                        {% endif %}
                                        {% set formattedAddress = formattedAddress  ~ " | " %}
                                    {% else %}
                                        {% if address.getStreetname() %}
                                            {% set formattedAddress = formattedAddress ~ address.getStreetname() ~ " | " %}
                                        {% endif %}
                                    {% endif %}
                                    <!--add the locality state combo-->
                                    {% if address.getLocality() %}
                                        {% set formattedAddress = formattedAddress ~ address.getLocality() %}
                                        {% if address.getState() %}
                                            {% set formattedAddress = formattedAddress ~ ", " ~ address.getState()%}
                                        {% endif %}
                                        {% set formattedAddress = formattedAddress  ~ " | " %}
                                    {% else %}
                                        {% if address.getState() %}
                                            {% set formattedAddress = formattedAddress ~ address.getState() ~ " | " %}
                                        {% endif %}
                                    {% endif %}
                                    <!--we know we are going to have a country and a continent so we simply the problem a bit-->
                                    {% set formattedAddress = formattedAddress ~ countryName ~ ", " ~ continentName %}
                                    <!--add the zip code if we have it-->
                                    {% if address.getZipcode() %}
                                        {% set formattedAddress = formattedAddress ~ " | " ~ address.getZipcode() %}
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                            <!--print the string we calculated above-->
                            {{ formattedAddress }}
                        </h5>
                        <p>posted: {{ property.getAdddate()|date("m/d/Y") }} | updated: {{ property.getLastupdated()|date("m/d/Y") }}</p>
                        <br>
                        {% if property.getDetails() %}
                            <h5>{{ property.getDetails() }}</h5>
                            <br>
                        {% endif %}
                        <h4>
                            <span>{{ property.getSquarefootage() }}</span>&nbsp;sqrft 
                            | 
                            <span>{{ property.getBedroomcount() }}</span>&nbsp;bed 
                            | 
                            <span>{{ property.getBathroomcount() }}</span>&nbsp;bath
                        </h4>
                        <br>
                        <h2>$<span>{{ property.getExpectedrentpermonth() }}</span></h2>
                        <br>
                        <button type="button" class="redirectButton" id="{{ property.getId() }}" class="btn btn-default btn-sm btn-primary">
                            <span>
                                {% if search %}
                                    More Details
                                {% else %}
                                    Edit Details
                                {% endif %}
                            </span><span class="fas fa-chevron-down margin-left: 15px;"></span>
                        </button>
                    </div>
                </div>
            </div>
            {% if search %}
                <div class="bottomSection">
                    <div class="row">
                        <div class="col-lg m-3">
                            <span class="fas fa-user"></span><span>{{ user.getName() }}</span>
                        </div>
                        <div class="col-lg m-3">
                            <span class="fas fa-envelope"></span><span>{{ user.getEmail() }}</span>
                        </div>
                        <div class="col-lg m-3">
                            <ul class="list-group userPhones">
                                    <li class="list-group-item list-group-item-dark">
                                        <span class="fas fa-phone"></span> Phone Numbers
                                    </li>
                                    {% for phone in phones %}
                                        {% if phone.getUserid() == user.getId() %}
                                            <li class="list-group-item">
                                                {% if phone.getDescription() %}
                                                    {{ phone.getDescription() }}&nbsp;|&nbsp;
                                                {% endif %}
                                                ({{ phone.getAreacode() }})&nbsp;{{ phone.getNumber() }}
                                                {% if phone.getExtension() %}
                                                &nbsp;ext&nbsp;{{ phone.getExtension() }}
                                                {% endif %}
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            {% else %}
                <p>availability switch here</p>
            {% endif %}
        </div>
    {% endfor %}

    {% if user %}
        <div class="container" id="addPropertySection">
            <form action="{{ base_url() }}/addProperty">
                <button type="submit" class="btn btn-primary" id="addPropertyButton">Add Property</button>
            </form>
        </div>
    {% endif %}

{% endblock %}

{% block styles %}
    <!--style sheet-->
    <link rel="stylesheet" href="{{ base_url() }}/../../TEMPLATES/properties/css.css">
{% endblock %}

{% block scripts %}
    <!--javascript-->
    <script src="{{ base_url() }}/../../TEMPLATES/properties/js.js"></script>
{% endblock %}